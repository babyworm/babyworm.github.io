{{/* Resolve Disqus shortname (services > params fallback) */}}
{{ $shortname := site.Config.Services.Disqus.Shortname | default site.Params.disqusShortname }}
{{ $auto := site.Params.disqus.autoLoad | default false }}

<div class="disqus-comment">
  {{/* autoLoad=true면 버튼 숨김, false면 버튼 보임 */}}
  {{ if not $auto }}
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    {{ i18n "loadDisqus" }}
  </div>
  {{ end }}
  <div id="disqus_thread"></div>

  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = {{ .Permalink | jsonify }};
      this.page.identifier = {{ with .File.Path }}{{ . | jsonify }}{{ else }}{{ .RelPermalink | jsonify }}{{ end }};
    };

    function load_disqus() {
      // 로컬(개발)에서는 주입 금지
      var host = window.location.hostname;
      if (host === 'localhost' || host === '127.0.0.1') return;

      var disqus_shortname = '{{ $shortname }}';
      if (!disqus_shortname) { console.warn('Disqus shortname missing'); return; }

      var s = document.createElement('script');
      s.type = 'text/javascript'; s.async = true;
      s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      (document.head || document.body).appendChild(s);

      var btn = document.getElementById('load_disqus');
      if (btn) btn.remove();
    }

    document.addEventListener('DOMContentLoaded', function() {
      try {
        // autoLoad=true면 즉시 로드, false면 버튼 기다림
        if ({{ if $auto }}true{{ else }}false{{ end }}) {
          load_disqus();
        }
      } catch (e) {}
    });
  </script>

  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
</div>

